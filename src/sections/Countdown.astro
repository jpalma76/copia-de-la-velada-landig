---
import LaVeladaIcon from "@/icons/LaVeladaIcon.astro"

const TIMESTAMP_END = 1729739220000
---

<section class="my-32 flex flex-col gap-y-10 justify-center items-center">
  <LaVeladaIcon />
  
  <div data-date={TIMESTAMP_END}>

    <div>
      <span data-days>00</span>
      <span>Días</span>
    </div>

    <div>
      <span data-hours>00</span>
      <span>Horas</span>
    </div>

    <div>
      <span data-minutes>00</span>
      <span>Minutos</span>
    </div>

    <div>
      <span data-seconds>00</span>
      <span>Segundos</span>
    </div>
  </div>
  <span>...para mi cumpleaños</span>
</section>

<script>
  const SECOND = 1000
  const MINUTE = SECOND * 60
  const HOUR = MINUTE * 60
  const DAY = HOUR * 24

  function init() {
    const $countdown = document.querySelector('[data-date]')
    if(!$countdown) return

    const $days = document.querySelector('[data-days]')
    const $hours = document.querySelector('[data-hours]')
    const $minutes = document.querySelector('[data-minutes]')
    const $seconds = document.querySelector('[data-seconds]')

    const timestamp = $countdown.getAttribute('data-date')
    if (!timestamp) return

    const date = new Date(+timestamp).getTime()
    
    function updateCountdown() {
      const now = Date.now()
      console.log(date);
      const diff = date - now
      
      if ($days instanceof HTMLElement) {
        $days.innerText = Math.floor(diff / DAY).toString();
      }
      if ($hours instanceof HTMLElement) {
        $hours.innerText = Math.floor(diff % DAY / HOUR).toString();
      }
      if ($minutes instanceof HTMLElement) {
        $minutes.innerText = Math.floor(diff % HOUR / MINUTE).toString();
      }
      if ($seconds instanceof HTMLElement) {
        $seconds.innerText = Math.floor(diff % MINUTE / SECOND).toString();
      }
    }

    setInterval(updateCountdown, SECOND)
  }
  init()
</script>